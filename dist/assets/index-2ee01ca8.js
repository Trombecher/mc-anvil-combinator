var ie=Object.defineProperty;var le=(i,t,e)=>t in i?ie(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var h=(i,t,e)=>(le(i,typeof t!="symbol"?t+"":t,e),e),K=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var n=(i,t,e)=>(K(i,t,"read from private field"),e?e.call(i):t.get(i)),k=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},I=(i,t,e,l)=>(K(i,t,"write to private field"),l?l.call(i,e):t.set(i,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function e(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(o){if(o.ep)return;o.ep=!0;const r=e(o);fetch(o.href,r)}})();var a,g,d,y;class Q{constructor(t){k(this,a,void 0);k(this,g,[]);k(this,d,[]);k(this,y,[]);I(this,a,t||[])}[Symbol.iterator](){return n(this,a).values()}reduce(t,e){for(let l=0;l<n(this,a).length;l++)e=t(e,n(this,a)[l],l);return e}map(t){const e=[];for(let l=0;l<n(this,a).length;l++)e.push(t(n(this,a)[l],l));return e}get length(){return n(this,a).length}add(t){this.set(n(this,a).length,t)}insert(t,e){n(this,a).splice(t,0,e);for(const l of n(this,y))l(t,e)}addAll(t){for(const e of t)this.add(e)}entries(){return n(this,a).entries()}every(t){return n(this,a).every(t)}fill(t,e,l){for(let o=e||0;o<(l||n(this,a).length)-1;o++)for(const r of n(this,d))r(o,this.get(o));return n(this,a).fill(t,e,l),this}removeIf(t){let e=this.length;for(;e--;)t(n(this,a)[e],e)&&this.removeAt(e)}extractIf(t){const e=[];let l=this.length;for(;l--;)t(n(this,a)[l],l)&&e.push(this.extractAt(l));return e}get(t){return n(this,a)[t]}subscribeToRemoveAt(t){return n(this,g).push(t),()=>n(this,g).splice(n(this,d).indexOf(t),1)}remove(t){const e=n(this,a).indexOf(t);return e===-1?!1:(this.removeAt(e),!0)}removeAt(t){n(this,a).splice(t,1);for(const e of n(this,g))e(t)}extractAt(t){for(const e of n(this,g))e(t);return n(this,a).splice(t,1)[0]}subscribeToInsert(t){return n(this,y).push(t),()=>{const e=n(this,y).indexOf(t);e!==-1&&n(this,y).splice(e,1)}}subscribeToSet(t){return n(this,d).push(t),()=>{const e=n(this,d).indexOf(t);e!==-1&&n(this,d).splice(e,1)}}set(t,e){n(this,a)[t]=e;for(const l of n(this,d))l(t,e)}clear(){for(let t=0;t<n(this,a).length;t++)for(const e of n(this,g))e(t);n(this,a).splice(0,n(this,a).length)}contains(t){return n(this,a).includes(t)}containsAll(t){e:for(const e of t){for(const l of this)if(e===l)continue e;return!1}return!0}first(t){for(let e=0;e<n(this,a).length;e++){const l=n(this,a)[e];if(t(l,e))return l}return null}indexOf(t){return n(this,a).indexOf(t)}isEmpty(){return n(this,a).length===0}nthIndexOf(t,e){let l=-1;for(const o of this)if(t===o&&(l++,l===e))return l;return l}lastIndexOf(t){return n(this,a).lastIndexOf(t)}removeAll(t){let e=!1;for(const l of t){const o=n(this,a).indexOf(l);o!==-1&&(e=!0,this.removeAt(o))}return e}retainAll(t){const e=[];for(const l of this)for(const o of t)l===o&&e.push(l);return e}subArray(t,e){const l=[];for(let o=Math.max(t,0);o<Math.min(n(this,a).length,e);o++)l.push(n(this,a)[o]);return l}toArray(){return n(this,a)}}a=new WeakMap,g=new WeakMap,d=new WeakMap,y=new WeakMap;var v,M;const V=class V{constructor(t){k(this,v,void 0);k(this,M,[]);I(this,v,t)}set value(t){if(n(this,v)!==t){I(this,v,t);for(const e of n(this,M))e(t)}}get value(){return n(this,v)}subscribe(t,e=!0){return e&&t(this.value),n(this,M).push(t),()=>n(this,M).splice(n(this,M).indexOf(t),1)}derive(t){const e=new V(t(this.value));return this.subscribe(l=>e.value=t(l),!1),e}};v=new WeakMap,M=new WeakMap;let u=V;function oe(i,t){const e=new Array(i.length);for(let o=0;o<i.length;o++){const r=i[o];e[o]=r.value,r.subscribe(s=>{e[o]=s,l.value=t(e)},!1)}const l=new u(t(e));return l}class ne{constructor(t,e){h(this,"nextIndex",0);h(this,"si",0);h(this,"strings");h(this,"nextValueIndex",0);h(this,"values");h(this,"char");this.strings=t,this.values=e}next(){return this.char=this.strings[this.si][this.nextIndex],this.nextIndex++,this.char}skipWS(){for(;S.test(this.char)&&this.hasNext();)this.next()}hasNext(){return this.strings[this.si].length>this.nextIndex}getNextValue(){return this.nextIndex=0,this.nextValueIndex++,this.si++,this.values[this.nextValueIndex-1]}hasNextValue(){return this.values.length>this.nextValueIndex}}function P(i,...t){const e=new ne(i,t),[l,o]=W(e);if(o)throw new Error("End tag without a starting tag");return l}const S=/\s/;function re(i){if(i.char){let t=i.char;for(;i.next(),!(i.char===">"||S.test(i.char));)t+=i.char;const e=document.createElement(t);_(i,e);const[l,o]=W(i);if(o!==t)throw new Error(`Start and end tags of native HTML element ${o} do not match`);return e.append(...l),[e]}else{const t=i.getNextValue();if(i.next(),typeof t!="function")throw new Error("Provided component is not a function");const e={};_(i,e);let l;if([e.children,l]=W(i),t!==l)throw new Error("Start and end tags of component do not match");return t(e)}}function _(i,t){for(;;){i.skipWS();let e="";for(;;){if(i.char===">"||i.char==="/"){e!==""&&(t[e]="");return}if(i.char==="=")break;if(S.test(i.char)){if(i.skipWS(),i.char!=="=")throw new Error(JSON.stringify(i));break}e+=i.char,i.next()}i.next();let l;if(i.char==='"'||i.char==="'"){const o=i.char;for(l="",i.next();i.char!==o;)l+=i.char,i.next()}else if(!i.char)l=i.getNextValue();else for(l="",i.next();!S.test(i.char);)l+=i.char,i.next();i.next(),e==="class"&&(e="className"),l instanceof u&&t instanceof HTMLElement?l.subscribe(o=>t[e]=o):e==="self"&&t instanceof HTMLElement?l(t):t[e]=l}}function se(i){if(i.next()!=="-"||i.next()!=="-")throw new Error("TODO");for(;i.next()==="-"&&i.next()==="-"&&i.next()===">";);}function W(i){const t=[];for(;;){const e=ae(i);if(typeof e=="string"||typeof e=="function")return[t,e];if(e&&t.push(...e),!i.hasNextValue()&&!i.hasNext())return[t]}}function ae(i){i.next();let t=!1;if(S.test(i.char)&&(t=!0,i.next(),i.skipWS()),i.char==="<"){if(i.next()==="!")return se(i);if(i.char==="/")if(i.next()){let e=i.char;for(;i.next()!==">";){if(S.test(i.char)){if(i.skipWS(),i.char!==">")throw new Error("Expected '>'");break}e+=i.char}return e}else{const e=i.getNextValue();if(i.next(),i.skipWS(),i.char!==">")throw new Error("Expected '>'");return e}else{if(i.char===">")throw new Error("Fragments are not supported");{const e=re(i);return t&&e.splice(0,0,document.createTextNode(" ")),e}}}else if(i.hasNext()){let e=(t?" ":"")+i.char;for(;i.hasNext();){if(i.next(),S.test(i.char)){if(e+=" ",i.next(),i.skipWS(),i.char==="<"){i.nextIndex--;break}else if(!i.hasNext())break}else if(i.char==="<"){i.nextIndex--;break}e+=i.char}return[document.createTextNode(e)]}else if(i.hasNextValue()){const e=[];t&&e.push(document.createTextNode(" "));const l=i.getNextValue();if(l instanceof u){const o=document.createTextNode(l.value);l.subscribe(r=>o.textContent=r,!1),e.push(o)}else l instanceof Node?e.push(l):l instanceof Array&&(l.length===0||l[0]instanceof Node)?e.push(...l):e.push(document.createTextNode(l+""));return e}else return[]}function G(i){const t=document.createComment(""),e=[...i.value];return t.after(...e),i.subscribe(l=>{for(let o of e)t.parentElement.removeChild(o);e.splice(0,e.length),e.push(...l),t.after(...l)},!1),[t,...i.value]}function z(i,t){const e=document.createComment(""),l=i.map(t);return i.subscribeToRemoveAt(o=>{const[r]=l.splice(o,1);r.parentElement.removeChild(r)}),i.subscribeToSet((o,r)=>{const s=t(r,o);if(o<l.length)e.parentElement.replaceChild(l[o],l[o]),l[o]=s;else{const c=l[l.length-1];e.parentElement.insertBefore(s,(c||e).nextSibling),l.push(s)}}),i.subscribeToInsert((o,r)=>{const s=t(r,o);l[o].parentElement.insertBefore(s,l[o]),l.splice(o,0,s)}),[e,...l]}const $=[{name:"Protection",id:"A",maxLevel:4,applicable:["Helmet","Chestplate","Leggings","Boots"],itemMultiplier:1,bookMultiplier:1,incompatible:["Fire Protection","Blast Protection","Projectile Protection"]},{name:"Fire Protection",id:"B",maxLevel:4,applicable:["Helmet","Chestplate","Leggings","Boots"],itemMultiplier:2,bookMultiplier:1,incompatible:["Protection","Blast Protection","Projectile Protection"]},{name:"Feather Falling",id:"C",maxLevel:4,applicable:["Boots"],itemMultiplier:2,bookMultiplier:1,incompatible:[]},{name:"Blast Protection",id:"D",maxLevel:4,applicable:["Helmet","Chestplate","Leggings","Boots"],itemMultiplier:4,bookMultiplier:2,incompatible:["Protection","Fire Protection","Projectile Protection"]},{name:"Projectile Protection",id:"E",maxLevel:4,applicable:["Helmet","Chestplate","Leggings","Boots"],itemMultiplier:2,bookMultiplier:1,incompatible:["Protection","Fire Protection","Blast Protection"]},{name:"Thorns",id:"F",maxLevel:3,applicable:["Helmet","Chestplate","Leggings","Boots"],itemMultiplier:8,bookMultiplier:4,incompatible:[]},{name:"Respiration",id:"G",maxLevel:3,applicable:["Helmet"],itemMultiplier:4,bookMultiplier:2,incompatible:[]},{name:"Depth Strider",id:"H",maxLevel:3,applicable:["Boots"],itemMultiplier:4,bookMultiplier:2,incompatible:["Frost Walker"]},{name:"Aqua Affinity",id:"I",maxLevel:1,applicable:["Helmet"],itemMultiplier:4,bookMultiplier:2,incompatible:[]},{name:"Sharpness",id:"J",maxLevel:5,applicable:["Sword","Axe"],itemMultiplier:1,bookMultiplier:1,incompatible:["Smite","Bane of Arthropods"]},{name:"Smite",id:"K",maxLevel:5,applicable:["Sword","Axe"],itemMultiplier:2,bookMultiplier:1,incompatible:["Sharpness","Bane of Arthropods"]},{name:"Bane of Arthropods",id:"L",maxLevel:5,applicable:["Sword","Axe"],itemMultiplier:2,bookMultiplier:1,incompatible:["Smite","Sharpness"]},{name:"Knockback",id:"M",maxLevel:2,applicable:["Sword"],itemMultiplier:2,bookMultiplier:1,incompatible:[]},{name:"Fire Aspect",id:"N",maxLevel:2,applicable:["Sword"],itemMultiplier:4,bookMultiplier:2,incompatible:[]},{name:"Looting",id:"O",maxLevel:3,applicable:["Sword"],itemMultiplier:4,bookMultiplier:2,incompatible:[]},{name:"Efficiency",id:"P",maxLevel:5,applicable:["Pickaxe","Shovel","Axe","Hoe","Shears"],itemMultiplier:1,bookMultiplier:1,incompatible:[]},{name:"Silk Touch",id:"Q",maxLevel:1,applicable:["Pickaxe","Shovel","Axe","Hoe"],itemMultiplier:8,bookMultiplier:4,incompatible:["Fortune"]},{name:"Unbreaking",id:"R",maxLevel:3,applicable:["Sword","Pickaxe","Shovel","Axe","Hoe","Fishing Rod","Helmet","Chestplate","Leggings","Boots","Bow","Shears","Flint and Steel","Carrot on a Stick","Warped Fungus on a Stick","Shield","Elytra","Trident","Crossbow"],itemMultiplier:2,bookMultiplier:1,incompatible:[]},{name:"Fortune",id:"S",maxLevel:3,applicable:["Pickaxe","Shovel","Axe","Hoe"],itemMultiplier:4,bookMultiplier:2,incompatible:["Silk Touch"]},{name:"Power",id:"T",maxLevel:5,applicable:["Bow"],itemMultiplier:1,bookMultiplier:1,incompatible:[]},{name:"Punch",id:"U",maxLevel:2,applicable:["Bow"],itemMultiplier:4,bookMultiplier:2,incompatible:[]},{name:"Flame",id:"V",maxLevel:1,applicable:["Bow"],itemMultiplier:4,bookMultiplier:2,incompatible:[]},{name:"Infinity",id:"W",maxLevel:1,applicable:["Bow"],itemMultiplier:8,bookMultiplier:4,incompatible:["Mending"]},{name:"Luck of the Sea",id:"X",maxLevel:3,applicable:["Fishing Rod"],itemMultiplier:4,bookMultiplier:2,incompatible:[]},{name:"Lure",id:"Y",maxLevel:3,applicable:["Fishing Rod"],itemMultiplier:4,bookMultiplier:2,incompatible:[]},{name:"Frost Walker",id:"Z",maxLevel:2,applicable:["Boots"],itemMultiplier:4,bookMultiplier:2,incompatible:["Depth Strider"]},{name:"Mending",id:"a",maxLevel:1,applicable:["Sword","Pickaxe","Shovel","Axe","Hoe","Fishing Rod","Helmet","Chestplate","Leggings","Boots","Bow","Shears","Flint and Steel","Carrot on a Stick","Warped Fungus on a Stick","Shield","Elytra","Trident","Crossbow"],itemMultiplier:4,bookMultiplier:2,incompatible:["Infinity"]},{name:"Curse of Binding",id:"b",maxLevel:1,applicable:["Helmet","Chestplate","Leggings","Boots","Elytra","Carved Pumpkin","Head"],itemMultiplier:8,bookMultiplier:4,incompatible:[]},{name:"Curse of Vanishing",id:"c",maxLevel:1,applicable:["Sword","Pickaxe","Shovel","Axe","Hoe","Fishing Rod","Helmet","Chestplate","Leggings","Boots","Bow","Shears","Flint and Steel","Carrot on a Stick","Warped Fungus on a Stick","Shield","Elytra","Trident","Crossbow","Carved Pumpkin","Head","Compass","Recovery Compass"],itemMultiplier:8,bookMultiplier:4,incompatible:[]},{name:"Impaling",id:"d",maxLevel:5,applicable:["Trident"],itemMultiplier:4,bookMultiplier:2,incompatible:[]},{name:"Riptide",id:"e",maxLevel:3,applicable:["Trident"],itemMultiplier:4,bookMultiplier:2,incompatible:["Loyalty","Channeling"]},{name:"Loyalty",id:"f",maxLevel:3,applicable:["Trident"],itemMultiplier:1,bookMultiplier:1,incompatible:["Riptide"]},{name:"Channeling",id:"g",maxLevel:1,applicable:["Trident"],itemMultiplier:8,bookMultiplier:4,incompatible:["Riptide"]},{name:"Multishot",id:"h",maxLevel:1,applicable:["Crossbow"],itemMultiplier:4,bookMultiplier:2,incompatible:["Piercing"]},{name:"Piecing",id:"i",maxLevel:4,applicable:["Crossbow"],itemMultiplier:1,bookMultiplier:1,incompatible:["Multishot"]},{name:"Quick Charge",id:"j",maxLevel:3,applicable:["Crossbow"],itemMultiplier:2,bookMultiplier:1,incompatible:[]},{name:"Soul Speed",id:"k",maxLevel:3,applicable:["Boots"],itemMultiplier:8,bookMultiplier:4,incompatible:[]},{name:"Swift Sneak",id:"l",maxLevel:3,applicable:["Leggings"],itemMultiplier:8,bookMultiplier:4,incompatible:[]},{name:"Sweeping Edge",id:"m",maxLevel:3,applicable:["Sword"],itemMultiplier:4,bookMultiplier:2,incompatible:[]}],L={Helmet:"A",Chestplate:"B",Leggings:"C",Boots:"D",Sword:"E",Axe:"F",Pickaxe:"G",Shovel:"H",Hoe:"I",Shears:"J","Fishing Rod":"K",Bow:"L","Flint and Steel":"M","Carrot on a Stick":"N","Warped Fungus on a Stick":"O",Shield:"P",Elytra:"Q",Trident:"R",Crossbow:"S","Carved Pumpkin":"T",Head:"U",Compass:"V","Recovery Compass":"W",Book:"X"};class F{constructor(t){h(this,"enchantments",[]);h(this,"priorWorkPenalty",0);h(this,"item");this.item=t}toString(){return`${this.item}(${this.enchantments.join(", ")}) (${this.priorWorkPenalty})`}addEnchantment(t,e){this.enchantments.push({type:$.find(l=>l.name===t),level:e})}static unpack(t){const e=new F(Object.keys(L).find(o=>L[o]===t[0])),l=t.substring(1).match(/.{2}/g);return l&&(e.enchantments=l.map(o=>({type:$.find(r=>r.id===o[0]),level:+o[1]}))),e}pack(){return`${L[this.item]}${this.enchantments.reduce((t,e)=>t+e.type.id+e.level,"")}`}}const E=(i,t)=>{if(i.item!==t.item&&t.item!=="Book")throw new Error(`Cannot combine items ${i.item} and ${t.item}`);const e={target:i,sacrifice:t,result:new F(i.item),cost:i.priorWorkPenalty+t.priorWorkPenalty},l=i.pack()+t.pack(),o=J.get(l);if(o)return e.result.enchantments.push(...o.result.enchantments),e.result.priorWorkPenalty=Math.max(i.priorWorkPenalty,t.priorWorkPenalty)*2+1,e.cost=o.cost-o.target.priorWorkPenalty-o.sacrifice.priorWorkPenalty+e.target.priorWorkPenalty+e.sacrifice.priorWorkPenalty,e;e.result.enchantments.push(...i.enchantments),e.result.priorWorkPenalty=Math.max(i.priorWorkPenalty,t.priorWorkPenalty)*2+1;for(const r of t.enchantments){if(i.item!=="Book"&&r.type.applicable.indexOf(i.item)===-1)continue;let s=null,c=!0;for(const p of e.result.enchantments){if(r.type.incompatible.indexOf(p.type.name)>0){e.cost+=1,c=!1;break}if(p.type===r.type){s=p;break}}if(!c)break;s?s.level<r.level?s.level=r.level:s.level===r.level&&s.level<s.type.maxLevel&&s.level++:(s={type:r.type,level:r.level},e.result.enchantments.push(s)),e.cost+=(t.item==="Book"?s.type.bookMultiplier:s.type.itemMultiplier)*s.level}return J.set(l,e),e},J=new Map;function R(i){if(i.length===2){const e={steps:[],totalCost:0};let l,o,r;try{l=E(i[0],i[1])}catch(c){r=c}try{o=E(i[1],i[0])}catch(c){if(r)throw c}const s=l&&o?l.cost<o.cost?l:o:l||o;return e.steps.push(s),e.totalCost=s.cost,[e]}const t=[];for(let e=0;e<(i.length-1)/2;e++){const l=[];X(i,l,e+1);for(const o of l){const r=e===0?[{steps:[],totalCost:0}]:R(o[0]),s=R(o[1]);for(const c of r)for(const p of s){const b=e===0?o[0][0]:c.steps.at(-1).result,D=p.steps.at(-1).result;let A,B,U;try{A=E(b,D)}catch(H){U=H}try{B=E(D,b)}catch(H){if(U)throw H}const q=A&&B?A.cost<B.cost?A:B:A||B,T={steps:[],totalCost:0};T.steps.push(...c.steps,...p.steps),T.steps.push(q),T.totalCost+=c.totalCost+p.totalCost+q.cost,t.push(T)}}}return t}function ce(i){let t=null;for(const e of i)(!t||e.totalCost<t.totalCost)&&(t=e);return t}function j(i){return $.find(t=>t.name===i)}function X(i,t,e,l=[],o=i.length){if(l.length===e){t.push([l,i]);return}for(let r=0;r<o;r++){const s=[...i],c=s.splice(r,1);c.push(...l);let p=t.length;if(X(s,t,e,c,r),l.length===i.length){const b=(p-t.length)/2;t.splice(-b,b)}}}const N=new URL(location.href).searchParams;function f(){N.set("i",x.map(i=>`${L[i.item.value]}${i.enchantments.reduce((t,e)=>t+$.find(l=>l.name===e.type.value).id+e.level.value,"")}`).join("-")),history.replaceState(null,"",`${location.pathname}?${N}`)}function Y(i,t){const e=new Q(i);e.subscribeToInsert(f),e.subscribeToRemoveAt(f),e.subscribeToSet(f);const l=new u(t);return l.subscribe(f,!1),{enchantments:e,item:l}}function Z(i,t){const e=new u(i),l=new u(t);return e.subscribe(f,!1),l.subscribe(f,!1),{type:e,level:l}}const x=new Q(N.get("i")?N.get("i").split("-").map(i=>{const t=i.substring(1).match(/.{2}/g);return Y(t?t.map(e=>Z($.find(l=>l.id===e[0]).name,+e[1])):[],Object.keys(L).find(e=>L[e]===i[0]))}):[]);x.subscribeToInsert(f);x.subscribeToRemoveAt(f);x.subscribeToSet(f);const pe=["0","I","II","III","IV","V"];function ue(){x.add(Y([],"Book"))}function ee(i){const t=document.createElement("div");return t.innerHTML=i,t.children[0]}function he(i){const t=document.createElement("div");t.innerHTML=i;const e=[];for(const l of t.childNodes)e.push(l);return e}const me=ee(`
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 7L8 12L13 7" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
`),de=ee(`
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 10L8 5L13 10" stroke="black" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
`);function m({children:i,className:t,reference:e,...l}){const o=P`
        <button
            class="px-3 py-0.5 rounded-full bg-gray-600/10 hover:bg-gray-600/20 transition flex items-center gap-1"
        >
            ${i}
        </button>
    `[1];return e&&e(o),Object.assign(o,l),t&&o.classList.add(...t.split(" ")),[o]}function C({options:i,target:t}){const e=new u(!1),l=me.cloneNode(!0),o=de.cloneNode(!0);e.subscribe(c=>{c?(l.style.display="none",o.style.display="block"):(l.style.display="block",o.style.display="none",document.onmousedown=null)});let r,s;return P`
        <div class="relative select-none">
            <${m}
                onclick=${c=>{e.value=!e.value,document.onmousedown=p=>{c.target!==p.target&&p.target!==r&&!r.contains(p.target)&&(e.value=!1)}}}
                reference=${c=>s=c}
            >
                ${t}
                ${l}
                ${o}
            </${m}>
            <div
                self=${c=>r=c}
                class=${e.derive(c=>{let p;if(c){const b=s.getBoundingClientRect();p=b.y+b.height+320>window.innerHeight?"bottom-[calc(100%+.5rem)]":"top-[calc(100%+.5rem)]"}else p="hidden";return`${p} z-10 absolute shadow-xl shadow-black/20 border border-gray-200 rounded-lg w-60 max-h-80 overflow-y-auto bg-white`})}>
                ${G(i.derive(c=>c.map(p=>P`
                    <button onclick=${()=>{e.value=!1,t.value=p}} class="px-3 py-0.5 block hover:bg-indigo-600 hover:text-white w-full text-left">${p}
                    </button>
                `[1])))}
            </div>
        </div>
    `}const fe=new u(Object.keys(L).sort()),w=new u(!1);w.subscribe(i=>{i&&(te.value=ce(R(x.map(t=>{const e=new F(t.item.value);return e.enchantments=t.enchantments.map(l=>({level:l.level.value,type:j(l.type.value)})),e}))))});const te=new u(null);function O({item:i}){return`
        <div class="table-cell">
            <h3>${i.item}</h3>
            ${i.enchantments.map(t=>`
                <div>${t.type.name} ${pe[t.level]}</div>
            `).join("")}
        </div>
    `}document.querySelector("#app").append(...P`
    <header class="py-6 bg-white/30 backdrop-blur-xl z-10 backdrop:saturate-200 sticky top-0 w-full flex justify-center gap-4 items-center">
        <${m} onclick=${ue}>+ Add Item</${m}>
        <div class="flex rounded-full bg-gray-600/10 p-1 gap-2">
            <button class=${w.derive(i=>`${i?"":"bg-gray-600/20 "}rounded-full px-4 hover:bg-gray-600/10 transition`)} onclick=${()=>w.value=!1}>Input</button>
            <button class=${w.derive(i=>`${i?"bg-gray-600/20 ":""}rounded-full px-4 hover:bg-gray-600/10 transition`)} onclick=${()=>w.value=!0}>Calculate</button>
        </div>
    </header>
    <main class="max-w-screen-md w-full px-6">
        <div class=${w.derive(i=>`${i?"hidden":""} flex flex-col gap-4`)}>
            ${z(x,i=>P`
                <div class="border border-gray-200 pt-4 pb-2 rounded-lg">
                    <div class="flex gap-4 mb-2 pb-4 mx-4 items-center border-b">
                        <img alt="" class="w-8 h-8 [image-rendering:pixelated]" src=${i.item.derive(t=>`/${t.toLowerCase().replaceAll(" ","_")}.png`)}></img>
                        <${C} options=${fe} target=${i.item}></${C}>
                        <${m} onclick=${()=>{i.enchantments.add(Z("Mending",1))}}>+ Add Enchantment
                        </${m}>
                        <${m} onclick=${()=>{x.removeIf(t=>t===i)}} className="ml-auto">
                            Delete Item
                        </${m}>
                    </div>
                    <div>
                        ${z(i.enchantments,t=>P`
                            <div
                                class=${oe([t.level,t.type],([e,l])=>`${j(l).maxLevel<e?"bg-yellow-300 ":""}flex gap-4 py-2 px-4`)}>
                                <${C}
                                    options=${i.item.derive(e=>e==="Book"?$.map(l=>l.name).sort():$.filter(l=>l.applicable.indexOf(e)!==-1).map(l=>l.name).sort())}
                                    target=${t.type}
                                ></${C}>
                                <${C}
                                    options=${t.type.derive(e=>new Array(j(e).maxLevel).fill(0).map((l,o)=>o+1))}
                                    target=${t.level}
                                ></${C}>
                                <${m} className="ml-auto" onclick=${()=>{i.enchantments.removeIf(e=>e===t)}}>Remove
                                </${m}>
                            </div>
                        `[1])}
                    </div>
                </div>
            `[1])}
        </div>
        <div class=${w.derive(i=>i?"":"hidden")}>
            ${G(te.derive(i=>i?he(`
                <h1 class="text-lg">Branch with total cost: ${i.totalCost}</h1>
                <div class="grid [grid-template-columns:min-content_min-content_1fr_1fr_1fr] gap-4">
                    <div>Step</div>
                    <div>Cost</div>
                    <div>Target</div>
                    <div>Sacrifice</div>
                    <div>Result</div>
                    ${i.steps.map((t,e)=>`
                        <div class="table-cell">${e+1}</div>
                        <div class="table-cell">${t.cost}</div>
                        ${O({item:t.target})}
                        ${O({item:t.sacrifice})}
                        ${O({item:t.result})}
                    `).join("")}
                </div>
            `):[]))}
        </div>
    </main>
    <footer class="p-6 text-gray-400 font-light mt-auto">
        © Trombecher ${new Date().getFullYear()}. All Rights Reserved.
    </footer>
`);
